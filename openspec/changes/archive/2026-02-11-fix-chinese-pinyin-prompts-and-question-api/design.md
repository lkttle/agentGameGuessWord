## Context

当前项目已具备房间、回合与结果页流程，但页面里仍残留英文猜词语义（如 `Target Word`、`Enter your guess`、默认词 `apple`），容易让用户误解为英文单词游戏。与此同时，后端缺少标准化的“中文拼音首字母题目”生成接口，无法为后续玩法提供稳定题源。

本次变更聚焦两个最小闭环：
- 将用户可见提示统一为“中文词语 + 拼音首字母”玩法语义。
- 提供独立题目生成 API（先不接前端），并对题目结构做强约束。

约束：
- 词语长度仅支持 2-4 个汉字。
- 每个字必须有对应拼音首字母。
- 输出必须包含 `拼音首字母序列 + 正确答案 + 分类提示`。

## Goals / Non-Goals

**Goals:**
- 在核心游戏页面中移除“英文单词猜测”提示，改为“拼音首字母猜中文词语”提示。
- 新增可独立调用的题目生成接口，返回结构化题目数据。
- 通过服务端校验确保题目合法（字数、首字母映射、分类字段完整）。
- 为后续前端接入题目接口保留稳定契约。

**Non-Goals:**
- 本轮不将题目生成接口接入现有房间对局流程。
- 本轮不重构猜词引擎计分逻辑与回合编排。
- 本轮不引入在线词库服务或复杂 AI 生成链路。
- 本轮不覆盖管理后台的词库运营能力。

## Decisions

1. **文案改造范围限定为真实用户路径（`/play` 与 `/room/[roomId]`）**
   - 决策：优先修改主流程页面中与玩法理解相关的标题、说明、按钮文案、占位提示和错误提示；开发调试组件可后续补齐。
   - 原因：以最小改动修复用户认知偏差，避免在非核心页面扩散改动。
   - 备选：全仓库一次性替换所有英文串（覆盖广但回归成本更高）。

2. **题目生成采用“本地结构化题库 + 随机筛选”而非实时拼音推导**
   - 决策：新增本地题库模块（如 `src/lib/game/pinyin-question-bank.ts`），每条题目显式存储答案、每字首字母数组、分类。
   - 原因：中文多音字会导致运行时拼音推导不稳定；显式存储更可控、可测试。
   - 备选：接入拼音库按答案动态计算首字母（实现快，但多音字和词义场景更易出错）。

3. **接口契约返回“逐字首字母数组 + 合并字符串”双形态**
   - 决策：接口返回 `initials: string[]`（逐字）与 `initialsText: string`（展示用，如 `CF`），并返回 `answer` 与 `category`。
   - 原因：`initials` 满足“每个字拼音开头”的机器校验，`initialsText` 方便展示与日志。
   - 备选：仅返回合并字符串（展示够用，但不利于严格校验）。

4. **接口采用 `POST /api/questions/generate`，支持可选筛选条件**
   - 决策：请求体支持 `length?: 2|3|4`、`category?: string`、`count?: number`（默认 1，最大 20）；响应返回 `questions` 数组。
   - 原因：方便后续同一接口支持单题与批量题目，且便于按分类/长度运营。
   - 备选：`GET` + query 参数（适合简单查询，但扩展性与请求校验可读性较弱）。

5. **服务端强校验与失败语义明确化**
   - 决策：新增校验器（如 `src/lib/game/pinyin-question-validator.ts`），校验规则：
     - `answer` 仅汉字且长度 2-4。
     - `initials.length === answer.length`。
     - 每个首字母为单个大写英文字母。
     - `category` 非空。
   - 原因：将题目质量问题拦截在 API 出口，避免前端承担数据清洗。
   - 备选：仅在写题库时人工保证（无运行时防线，风险高）。

## Risks / Trade-offs

- [题库规模较小时随机结果重复率高] → 先支持 `count` 批量去重抽样，后续扩充分类与词条。
- [分类命名不统一导致前端过滤困难] → 先定义有限分类枚举（动作、动物、水果、食物、职业、地点等）并集中维护。
- [页面文案改动遗漏局部英文提示] → 以 `/play` 与 `/room/[roomId]` 做清单化检查，后续补充快照/文案扫描。
- [未来接入实时生成时契约变化] → 先固化响应字段，新增字段走向后兼容扩展，不删旧字段。

## Migration Plan

1. 在 `src/lib/game/` 下新增题库与校验模块，补充基础词条（覆盖 2/3/4 字、多个分类）。
2. 新增 `src/app/api/questions/generate/route.ts`，实现筛选、抽样、校验和响应封装。
3. 修改 `src/app/play/page.tsx` 与 `src/app/room/[roomId]/page.tsx` 的玩法提示文案，去除英文猜词心智。
4. 使用接口级自测（`curl` 或本地请求）验证：
   - 正常返回包含 `initials`、`initialsText`、`answer`、`category`。
   - `length/category/count` 过滤正确。
   - 无可用题目时返回明确错误（如 `422`）。

回滚策略：
- 文案改动可直接回退对应页面文件。
- 新接口为增量能力，不影响现有对局链路；必要时可下线路由并保留题库模块。

## Open Questions

- 分类字段是否需要固定英文枚举值（如 `action`, `animal`）并额外返回中文展示名？
- 是否允许同一首字母对应多答案时在响应中附带干扰项（用于后续选择题玩法）？
- 题目去重范围是“单次请求内去重”还是“会话级去重”（需与后续前端接入策略对齐）？
